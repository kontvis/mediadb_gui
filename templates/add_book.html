{% extends 'base.html' %}
{% block content %}
  <h2>Add Book</h2>
  <form method="post">
    <div class="mb-3">
      <label class="form-label">Title *</label>
      <input name="title" class="form-control" placeholder="Enter book title" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Author</label>
      <input name="author" class="form-control" placeholder="Author name">
    </div>
    <div class="mb-3">
      <label class="form-label">Year</label>
      <input name="year" class="form-control" placeholder="Year (e.g., 2020)">
    </div>
    <div class="mb-3">
      <label class="form-label">ISBN</label>
      <input name="isbn" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Publisher</label>
      <input name="publisher" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Page Count</label>
      <input name="page_count" class="form-control" type="number">
    </div>
    <div class="mb-3">
      <label class="form-label">Genre</label>
      <input name="genre" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Notes</label>
      <textarea name="notes" class="form-control"></textarea>
    </div>
    <button class="btn btn-primary">Add Book</button>
  </form>
    <script>
      // Autofill from lookup if available
      (function(){
        try {
          let raw = localStorage.getItem('barcode_prefill') || localStorage.getItem('photo_prefill');
          if (!raw) return;
          const data = JSON.parse(raw);
          if (!data) return;
          // populate fields
          if (data.title) document.querySelector('input[name=title]').value = data.title;
          if (data.author) document.querySelector('input[name=author]').value = data.author;
          if (data.year) document.querySelector('input[name=year]').value = data.year;
          if (data.isbn) document.querySelector('input[name=isbn]').value = data.isbn;
          if (data.publisher) document.querySelector('input[name=publisher]').value = data.publisher;
          if (data.book_genre) document.querySelector('input[name=genre]').value = data.book_genre;
          if (data.notes) document.querySelector('textarea[name=notes]').value = data.notes;
          // clear after use
          localStorage.removeItem('barcode_prefill');
          localStorage.removeItem('photo_prefill');
        } catch(e) { console.error(e); }
      })();
    </script>
{% endblock %}
