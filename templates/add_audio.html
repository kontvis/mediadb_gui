{% extends 'base.html' %}
{% block content %}
  <h2>Add Audio</h2>
  <form method="post">
    <div class="mb-3">
      <label class="form-label">Title *</label>
      <input name="title" class="form-control" placeholder="Enter title" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Artist</label>
      <input name="artist" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Album</label>
      <input name="album" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Track Count</label>
      <input name="track_count" class="form-control" type="number">
    </div>
    <div class="mb-3">
      <label class="form-label">Format</label>
      <input name="format" class="form-control" placeholder="CD / MP3 / Vinyl">
    </div>
    <div class="mb-3">
      <label class="form-label">Genre</label>
      <input name="genre" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Year</label>
      <input name="year" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Notes</label>
      <textarea name="notes" class="form-control"></textarea>
    </div>
    <button class="btn btn-primary">Add Audio</button>
  </form>
  <script>
    (function(){
      try {
        let raw = localStorage.getItem('barcode_prefill') || localStorage.getItem('photo_prefill');
        if (!raw) return;
        const data = JSON.parse(raw);
        if (!data) return;
        if (data.title) document.querySelector('input[name=title]').value = data.title;
        if (data.artist) document.querySelector('input[name=artist]').value = data.artist;
        if (data.album) document.querySelector('input[name=album]').value = data.album;
        if (data.track_count) document.querySelector('input[name=track_count]').value = data.track_count;
        if (data.audio_format) document.querySelector('input[name=format]').value = data.audio_format;
        if (data.audio_genre) document.querySelector('input[name=genre]').value = data.audio_genre;
        if (data.year) document.querySelector('input[name=year]').value = data.year;
        if (data.notes) document.querySelector('textarea[name=notes]').value = data.notes;
        localStorage.removeItem('barcode_prefill');
        localStorage.removeItem('photo_prefill');
      } catch(e) { console.error(e); }
    })();
  </script>
{% endblock %}
